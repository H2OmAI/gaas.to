<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shadow Mode &mdash; GaaS Documentation</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&family=JetBrains+Mono:wght@400;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="favicon.png">
</head>
<body>
  <header>
    <a class="logo" href="index.html"><img src="logo.png" alt="GaaS"></a>
    <nav>
      <a href="index.html">Docs</a>
      <a href="https://gaas.is">Home</a>
      <a href="https://github.com/H2OmAI">GitHub</a>
    </nav>
  </header>

  <main>
    <h1 class="fade-in">Shadow Mode</h1>
    <p class="subtitle fade-in">
      Run the full governance pipeline on real agent actions without enforcing decisions. See what GaaS would do before turning it on.
    </p>

    <h2 class="fade-in">Why Shadow Mode</h2>
    <p>
      No governance system should go from zero to enforcement without a trial period. Shadow mode lets you observe the full pipeline &mdash; validation, enrichment, policy evaluation, deliberation, and decision assembly &mdash; on real traffic, while your agents continue to operate freely.
    </p>
    <p>
      You get real governance decisions tagged as shadow. You see what would have been blocked, what would have been modified, what would have triggered escalation. You can review, submit feedback, and refine your membrane &mdash; all before a single action is actually blocked.
    </p>

    <hr class="divider">

    <h2 class="fade-in">How to Enable</h2>

    <h3>Option 1: Query Parameter</h3>
    <p>
      Add <code>?mode=shadow</code> to any intent submission:
    </p>
    <div class="endpoint">
      <span class="method method-post">POST</span>
      <span class="path">/v1/intents?mode=shadow</span>
      <p class="desc">Submit an intent for shadow evaluation &mdash; full pipeline, no enforcement</p>
    </div>
    <p>
      The intent is processed through the full 5-stage pipeline. The response is identical to a live decision &mdash; same verdict, same risk assessment, same reasoning &mdash; but the <code>pipeline_mode</code> field is set to <code>shadow</code> and no enforcement occurs.
    </p>

    <h3>Option 2: Membrane Lifecycle</h3>
    <p>
      When you onboard via the <a class="link" href="onboarding.html">quickstart endpoint</a>, your membrane starts in <code>SHADOW</code> mode automatically. All intents evaluated against that membrane run through shadow mode by default until you explicitly activate live mode.
    </p>

    <div class="note">
      <strong>Per-intent control.</strong> Shadow mode can be set per-intent with the <code>?mode=shadow</code> query parameter, regardless of the membrane's state. This means you can run shadow on some intents while others go through live evaluation.
    </div>

    <hr class="divider">

    <h2 class="fade-in">Membrane Lifecycle</h2>
    <p>
      The membrane moves through three defined states:
    </p>
    <div class="flow fade-in">
      <div class="flow-step">
        <div class="flow-icon">1</div>
        <div class="flow-content">
          <h3>DRAFT</h3>
          <p>Membrane is being generated. Not yet evaluating intents.</p>
        </div>
      </div>
      <div class="flow-step">
        <div class="flow-icon">2</div>
        <div class="flow-content">
          <h3>SHADOW</h3>
          <p>Full pipeline evaluation on real traffic. Decisions are logged but not enforced. This is the default after quickstart onboarding.</p>
        </div>
      </div>
      <div class="flow-step">
        <div class="flow-icon">3</div>
        <div class="flow-content">
          <h3>LIVE</h3>
          <p>Governance decisions are enforced. Agents must act on verdicts.</p>
        </div>
      </div>
    </div>

    <div class="note">
      <strong>Reversible.</strong> You can move from LIVE back to SHADOW at any time. All audit records from both modes are preserved.
    </div>

    <hr class="divider">

    <h2 class="fade-in">What Happens Differently</h2>
    <table>
      <tr>
        <th>Behavior</th>
        <th>Live</th>
        <th>Shadow</th>
      </tr>
      <tr>
        <td>Full pipeline evaluation</td>
        <td>Yes</td>
        <td>Yes</td>
      </tr>
      <tr>
        <td>Decision returned to caller</td>
        <td>Enforced</td>
        <td>Informational</td>
      </tr>
      <tr>
        <td>Escalations created</td>
        <td>Yes</td>
        <td>No</td>
      </tr>
      <tr>
        <td>Learning observations</td>
        <td>Tagged <code>live</code></td>
        <td>Tagged <code>shadow</code></td>
      </tr>
      <tr>
        <td>Dashboard live metrics</td>
        <td>Included</td>
        <td>Excluded</td>
      </tr>
      <tr>
        <td>Shadow stats updated</td>
        <td>No</td>
        <td>Yes</td>
      </tr>
      <tr>
        <td>Audit trail recorded</td>
        <td>Yes</td>
        <td>Yes</td>
      </tr>
      <tr>
        <td>Response pipeline_mode</td>
        <td><code>live</code></td>
        <td><code>shadow</code></td>
      </tr>
    </table>

    <div class="warning">
      <strong>Critical safety exception.</strong> If GaaS detects an action in shadow mode that would trigger a Tier&nbsp;1 critical block in live &mdash; for example, sending regulated data over an unencrypted channel &mdash; it breaks silence and alerts you immediately. Safety does not wait for the shadow period to end.
    </div>

    <hr class="divider">

    <h2 class="fade-in">Monitoring Shadow Decisions</h2>

    <h3>Decision Stream</h3>
    <p>
      The <a class="link" href="dashboard.html">conversational dashboard</a> supports filtering the decision stream by pipeline mode. Ask:
    </p>
    <p style="font-style: italic; color: var(--accent); margin-bottom: 0.5rem;">
      "Show me shadow decisions from the last 7 days"
    </p>
    <p>
      Or query the API directly:
    </p>
    <div class="endpoint">
      <span class="method method-get">GET</span>
      <span class="path">/v1/dashboard/decisions?pipeline_mode=shadow&amp;time_range=last_7d</span>
    </div>

    <h3>Shadow Stats</h3>
    <p>
      Each membrane tracks aggregate shadow statistics: total shadow decisions, verdict distribution, average risk score, contradiction rate, and policy coverage.
    </p>
    <div class="endpoint">
      <span class="method method-get">GET</span>
      <span class="path">/v1/membranes/{membrane_id}/shadow/stats</span>
      <p class="desc">Aggregate shadow mode statistics for a membrane</p>
    </div>

    <h3>Submitting Feedback</h3>
    <p>
      While reviewing shadow decisions, flag false positives or false negatives. The learning engine uses this feedback to refine your membrane before you go live.
    </p>

    <hr class="divider">

    <h2 class="fade-in">Transitioning to Live</h2>

    <div class="step-label">STEP 1</div>
    <h3>Review Shadow Data</h3>
    <p>
      Focus on:
    </p>
    <ul>
      <li>Decisions that <strong>would have blocked</strong> legitimate actions (false positives)</li>
      <li>Decisions that <strong>approved actions</strong> you would have wanted blocked (false negatives)</li>
      <li>Escalation triggers that seem too sensitive or not sensitive enough</li>
    </ul>

    <div class="step-label">STEP 2</div>
    <h3>Submit Feedback</h3>
    <p>
      Mark incorrect decisions through the dashboard or the learning API. The learning engine factors this into calibration.
    </p>

    <div class="step-label">STEP 3</div>
    <h3>Activate</h3>
    <p>
      When confident, switch to live mode:
    </p>
    <pre><code>POST /v1/membranes/{membrane_id}/activate

{
  "activation": {
    "mode": "live"
  }
}</code></pre>

    <div class="note">
      <strong>Instant rollback.</strong> If anything looks wrong after going live, revert to shadow mode with a single call. Your agents continue operating, and governance decisions become informational again immediately.
    </div>

    <hr class="divider">

    <h2 class="fade-in">Related Pages</h2>
    <ul>
      <li><a class="link" href="getting-started.html">Getting Started</a> &mdash; the full three-step quickstart</li>
      <li><a class="link" href="onboarding.html">Onboarding</a> &mdash; membrane generation and lifecycle details</li>
      <li><a class="link" href="dashboard.html">Conversational Dashboard</a> &mdash; monitor shadow decisions through the conversational interface</li>
    </ul>

  </main>

  <footer>
    <a href="https://gaas.is">&copy; H2Om</a>
  </footer>

  <script>
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1 });
    document.querySelectorAll('.fade-in').forEach(el => observer.observe(el));
  </script>
</body>
</html>
