<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="favicon.png">
  <title>Rate Limits — GaaS Documentation</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #0a0e17;
      color: #c9d1d9;
      line-height: 1.6;
      min-height: 100vh;
    }
    #meshCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
    }

    header {
      border-bottom: 1px solid #1e2533;
      padding: 1.5rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    header .logo {
      font-size: 1.25rem;
      font-weight: 700;
      color: #e6edf3;
      letter-spacing: -0.02em;
      text-decoration: none;
    }

    header .logo span { color: #58a6ff; }

    header nav a {
      color: #8b949e;
      text-decoration: none;
      margin-left: 1.5rem;
      font-size: 0.875rem;
    }

    header nav a:hover { color: #e6edf3; }

    main {
      max-width: 720px;
      margin: 0 auto;
      padding: 4rem 2rem;
    }

    h1 {
      font-size: 2.25rem;
      font-weight: 700;
      color: #e6edf3;
      margin-bottom: 0.75rem;
      letter-spacing: -0.03em;
    }

    .subtitle {
      font-size: 1.125rem;
      color: #8b949e;
      margin-bottom: 3rem;
    }

    h2 {
      font-size: 1.25rem;
      font-weight: 600;
      color: #e6edf3;
      margin-top: 2.5rem;
      margin-bottom: 1rem;
    }

    h3 {
      font-size: 1rem;
      font-weight: 600;
      color: #e6edf3;
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
    }

    p { margin-bottom: 1rem; font-size: 0.9375rem; }

    pre {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 6px;
      padding: 1.25rem;
      overflow-x: auto;
      margin-bottom: 1.5rem;
      font-size: 0.8125rem;
      line-height: 1.5;
    }

    code {
      font-family: "SF Mono", "Fira Code", "Fira Mono", Menlo, Consolas, monospace;
      color: #e6edf3;
    }

    p code, li code {
      background: #161b22;
      padding: 0.15em 0.4em;
      border-radius: 3px;
      font-size: 0.85em;
    }

    .note {
      background: #161b22;
      border-left: 3px solid #58a6ff;
      padding: 1rem 1.25rem;
      margin-bottom: 1.5rem;
      font-size: 0.875rem;
      border-radius: 0 6px 6px 0;
    }

    .note strong { color: #58a6ff; }

    .warning {
      background: #161b22;
      border-left: 3px solid #d29922;
      padding: 1rem 1.25rem;
      margin-bottom: 1.5rem;
      font-size: 0.875rem;
      border-radius: 0 6px 6px 0;
    }

    .warning strong { color: #d29922; }

    ul, ol { margin-bottom: 1rem; padding-left: 1.25rem; }
    li { margin-bottom: 0.35rem; font-size: 0.9375rem; }

    a.link { color: #58a6ff; text-decoration: none; }
    a.link:hover { text-decoration: underline; }

    .comment { color: #8b949e; }
    .keyword { color: #ff7b72; }
    .string { color: #a5d6ff; }
    .func { color: #d2a8ff; }

    .divider {
      border: none;
      border-top: 1px solid #1e2533;
      margin: 2.5rem 0;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1.5rem;
      font-size: 0.875rem;
    }

    th {
      background: #161b22;
      color: #e6edf3;
      font-weight: 600;
      text-align: left;
      padding: 0.75rem 1rem;
      border: 1px solid #30363d;
    }

    td {
      padding: 0.75rem 1rem;
      border: 1px solid #30363d;
    }

    tr:nth-child(even) { background: #0d1117; }

    footer {
      max-width: 720px;
      margin: 0 auto;
      padding: 2rem;
      border-top: 1px solid #1e2533;
      font-size: 0.8rem;
      color: #484f58;
      text-align: center;
    }

    footer a { color: #484f58; text-decoration: none; }
    footer a:hover { color: #8b949e; }

    @media (max-width: 600px) {
      h1 { font-size: 1.75rem; }
      main { padding: 2.5rem 1.25rem; }
    }
  </style>
</head>
<body>
<canvas id="meshCanvas"></canvas>
  <header>
    <a class="logo" href="index.html">G<span>aa</span>S</a>
    <nav>
      <a href="search.html">Search</a>
      <a href="index.html">Docs</a>
      <a href="https://gaas.is">Home</a>
      <a href="https://github.com/H2OmAI">GitHub</a>
    </nav>
  </header>

  <main>
    <h1>Rate Limits</h1>
    <p class="subtitle">
      Per-endpoint request throttling with distributed sliding-window rate limiting.
    </p>

    <h2>Overview</h2>
    <p>
      GaaS enforces rate limits to prevent abuse, ensure fair resource allocation, and maintain system stability. Rate limits are applied per API key (organization) and vary by endpoint.
    </p>

    <p>
      When you exceed a rate limit, the API returns an HTTP <code>429 Too Many Requests</code> response with a <code>Retry-After</code> header indicating when you can retry.
    </p>

    <div class="note">
      <strong>Distributed Rate Limiting:</strong> In production (when <code>GAAS_DATABASE_URL</code> is set), GaaS uses Postgres-backed distributed rate limiting with atomic sliding-window counters. This ensures accurate rate limiting across multiple API server instances.
    </div>

    <hr class="divider">

    <h2 id="per-endpoint-rate-limits">Per-Endpoint Rate Limits</h2>
    <p>
      Different endpoints have different rate limits based on their resource intensity:
    </p>

    <table>
      <thead>
        <tr>
          <th>Endpoint Category</th>
          <th>Limit</th>
          <th>Window</th>
          <th>Examples</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Intent Submission</strong></td>
          <td>20 requests</td>
          <td>Per minute</td>
          <td><code>POST /v1/intents</code><br><code>POST /v1/intents/batch</code></td>
        </tr>
        <tr>
          <td><strong>Backtest</strong></td>
          <td>5 requests</td>
          <td>Per minute</td>
          <td><code>POST /v1/learning/backtest</code></td>
        </tr>
        <tr>
          <td><strong>Onboarding</strong></td>
          <td>10 requests</td>
          <td>Per minute</td>
          <td><code>POST /v1/onboarding/quickstart</code><br><code>POST /v1/onboarding/intake</code></td>
        </tr>
        <tr>
          <td><strong>Authentication (IP-based)</strong></td>
          <td>5 requests</td>
          <td>Per minute</td>
          <td>Dashboard login, signup, MFA verification</td>
        </tr>
        <tr>
          <td><strong>General Endpoints</strong></td>
          <td>120 requests</td>
          <td>Per minute</td>
          <td>All other API endpoints (decisions, escalations, audit, webhooks, etc.)</td>
        </tr>
      </tbody>
    </table>

    <div class="warning">
      <strong>Chat Rate Limit:</strong> The dashboard conversational chat interface is limited to <strong>10 requests per minute</strong> per authenticated user (tracked by session).
    </div>

    <hr class="divider">

    <h2 id="429-response-format">429 Response Format</h2>
    <p>
      When you exceed a rate limit, the API returns a <code>429 Too Many Requests</code> response:
    </p>

    <pre><code>POST https://api.gaas.is/v1/intents
X-API-Key: your_api_key

<span class="comment"># Response (when rate limit exceeded):</span>
HTTP/1.1 429 Too Many Requests
Retry-After: 42
X-RateLimit-Limit: 20
X-RateLimit-Remaining: 0
X-RateLimit-Reset: 1707824460
Content-Type: application/json

{
  "error": {
    "code": "rate_limit_exceeded",
    "message": "Rate limit exceeded for POST /v1/intents. Limit: 20 requests per minute. Retry after 42 seconds.",
    "retry_after_seconds": 42
  }
}</code></pre>

    <h3>Rate Limit Headers</h3>
    <p>
      All successful responses (2xx) include rate limit headers:
    </p>

    <ul>
      <li><code>X-RateLimit-Limit</code> — Maximum requests allowed in the window</li>
      <li><code>X-RateLimit-Remaining</code> — Requests remaining in current window</li>
      <li><code>X-RateLimit-Reset</code> — Unix timestamp when the rate limit resets</li>
    </ul>

    <p>
      On 429 responses, the <code>Retry-After</code> header indicates the number of seconds to wait before retrying.
    </p>

    <hr class="divider">

    <h2 id="rate-limit-scoping">Rate Limit Scoping</h2>

    <h3>Per API Key (org_id)</h3>
    <p>
      Most rate limits are scoped to your API key (organization). This means all requests from your organization count toward the same limit, regardless of which agent or service is making the request.
    </p>

    <h3>Per IP Address</h3>
    <p>
      Authentication endpoints (login, signup, MFA verification) are rate-limited per IP address (not per API key) to prevent brute-force attacks. This applies to the dashboard authentication routes only.
    </p>

    <hr class="divider">

    <h2 id="handling-rate-limits">Handling Rate Limits</h2>

    <h3>Python (gaas_sdk)</h3>
    <pre><code><span class="keyword">import</span> time
<span class="keyword">from</span> gaas_sdk <span class="keyword">import</span> GaaSClient
<span class="keyword">from</span> gaas_sdk.exceptions <span class="keyword">import</span> RateLimitError

<span class="keyword">async with</span> <span class="func">GaaSClient</span>(<span class="string">"https://api.gaas.is"</span>, headers={<span class="string">"X-API-Key"</span>: api_key}) <span class="keyword">as</span> client:
    <span class="keyword">try</span>:
        response = <span class="keyword">await</span> client.<span class="func">submit_intent</span>(intent)
    <span class="keyword">except</span> RateLimitError <span class="keyword">as</span> e:
        retry_after = e.retry_after_seconds
        <span class="func">print</span>(<span class="string">f"Rate limited. Retrying after {retry_after} seconds..."</span>)
        time.<span class="func">sleep</span>(retry_after)
        response = <span class="keyword">await</span> client.<span class="func">submit_intent</span>(intent)  <span class="comment"># Retry</span></code></pre>

    <h3>TypeScript (@gaas/sdk)</h3>
    <pre><code><span class="keyword">import</span> { GaaSClient, RateLimitError } <span class="keyword">from</span> <span class="string">'@gaas/sdk'</span>;

<span class="keyword">const</span> client = <span class="keyword">new</span> <span class="func">GaaSClient</span>({ baseUrl: <span class="string">'https://api.gaas.is'</span>, headers: { ... } });

<span class="keyword">try</span> {
  <span class="keyword">const</span> response = <span class="keyword">await</span> client.<span class="func">submitIntent</span>(intent);
} <span class="keyword">catch</span> (error) {
  <span class="keyword">if</span> (error <span class="keyword">instanceof</span> RateLimitError) {
    <span class="keyword">const</span> retryAfter = error.retryAfterSeconds;
    console.<span class="func">log</span>(<span class="string">`Rate limited. Retrying after ${retryAfter}s...`</span>);
    <span class="keyword">await new</span> <span class="func">Promise</span>(resolve => <span class="func">setTimeout</span>(resolve, retryAfter * 1000));
    <span class="keyword">const</span> response = <span class="keyword">await</span> client.<span class="func">submitIntent</span>(intent);  <span class="comment">// Retry</span>
  }
}</code></pre>

    <h3>Java (com.gaas.sdk)</h3>
    <pre><code><span class="keyword">import</span> com.gaas.sdk.GaaSClient;
<span class="keyword">import</span> com.gaas.sdk.exceptions.RateLimitException;

<span class="keyword">try</span> {
    GaaSResponse response = client.<span class="func">submitIntent</span>(intent);
} <span class="keyword">catch</span> (RateLimitException e) {
    <span class="keyword">int</span> retryAfter = e.<span class="func">getRetryAfterSeconds</span>();
    System.out.<span class="func">println</span>(<span class="string">"Rate limited. Retrying after "</span> + retryAfter + <span class="string">" seconds..."</span>);
    Thread.<span class="func">sleep</span>(retryAfter * 1000);
    GaaSResponse response = client.<span class="func">submitIntent</span>(intent);  <span class="comment">// Retry</span>
}</code></pre>

    <hr class="divider">

    <h2 id="best-practices">Best Practices</h2>

    <h3>1. Implement Exponential Backoff</h3>
    <p>
      When a request is rate-limited, wait for the duration specified in <code>Retry-After</code>, then retry. If you hit the limit again, double the wait time with each subsequent retry:
    </p>

    <pre><code><span class="keyword">async def</span> <span class="func">submit_with_backoff</span>(client, intent, max_retries=3):
    retry_delay = 1
    <span class="keyword">for</span> attempt <span class="keyword">in</span> <span class="func">range</span>(max_retries):
        <span class="keyword">try</span>:
            <span class="keyword">return await</span> client.<span class="func">submit_intent</span>(intent)
        <span class="keyword">except</span> RateLimitError <span class="keyword">as</span> e:
            <span class="keyword">if</span> attempt == max_retries - 1:
                <span class="keyword">raise</span>  <span class="comment"># Final attempt failed</span>
            retry_delay = e.retry_after_seconds * (2 ** attempt)
            <span class="keyword">await</span> asyncio.<span class="func">sleep</span>(retry_delay)</code></pre>

    <h3>2. Batch Requests Where Possible</h3>
    <p>
      Use the bulk intent submission endpoint (<code>POST /v1/intents/batch</code>) to submit up to 50 intents in a single request. This counts as 1 request toward the rate limit instead of 50.
    </p>

    <h3>3. Monitor Rate Limit Headers</h3>
    <p>
      Check <code>X-RateLimit-Remaining</code> on every response. If it's low (e.g., <10), slow down your request rate proactively to avoid hitting the limit.
    </p>

    <pre><code>remaining = int(response.headers[<span class="string">'X-RateLimit-Remaining'</span>])
<span class="keyword">if</span> remaining < 10:
    <span class="func">print</span>(<span class="string">"Approaching rate limit. Slowing down requests..."</span>)
    time.<span class="func">sleep</span>(5)  <span class="comment"># Pause before next request</span></code></pre>

    <h3>4. Use Shadow Mode for Load Testing</h3>
    <p>
      Shadow mode intent submissions (<code>?mode=shadow</code>) are still subject to rate limits. When load testing, ensure your test traffic doesn't exceed the 20 req/min intent submission limit. Consider using multiple API keys to distribute load.
    </p>

    <h3>5. Cache Read-Only Data</h3>
    <p>
      Responses for read-only endpoints (e.g., <code>GET /v1/decisions/{id}</code>) include <code>ETag</code> headers. Cache these responses locally and use <code>If-None-Match</code> headers to get 304 Not Modified responses, which don't count toward rate limits.
    </p>

    <hr class="divider">

    <h2 id="upgrading-rate-limits">Upgrading Rate Limits</h2>
    <p>
      Rate limits are <strong>not</strong> tied to pricing tiers—all organizations (including Developer tier) have the same rate limits. This is intentional to ensure fair access.
    </p>

    <p>
      If you need higher rate limits for high-volume production use cases, contact <a class="link" href="mailto:sales@gaas.is">sales@gaas.is</a> to discuss custom Enterprise rate limits. Enterprise plans can negotiate:
    </p>

    <ul>
      <li>Higher intent submission limits (e.g., 100 req/min instead of 20)</li>
      <li>Dedicated API endpoints with isolated rate limits</li>
      <li>Burst allowances (temporary rate limit increases)</li>
    </ul>

    <hr class="divider">

    <h2 id="troubleshooting">Troubleshooting</h2>

    <h3>Getting 429 Errors Despite Low Traffic</h3>
    <p><strong>Cause:</strong> Multiple services or agents sharing the same API key are collectively exceeding the limit.</p>
    <p><strong>Solution:</strong> Monitor <code>X-RateLimit-Remaining</code> headers. Consider using separate API keys for different services (requires separate organizations).</p>

    <h3>Rate Limit Not Resetting</h3>
    <p><strong>Cause:</strong> Sliding window means the limit resets gradually as old requests age out of the 1-minute window, not all at once.</p>
    <p><strong>Solution:</strong> Wait at least 60 seconds from your last successful request before retrying at full speed.</p>

    <h3>Auth Endpoints Blocked by IP Rate Limit</h3>
    <p><strong>Cause:</strong> Dashboard authentication endpoints (login, signup, MFA) are limited to 5 req/min per IP address.</p>
    <p><strong>Solution:</strong> If multiple users share a single outbound IP (e.g., corporate NAT), requests may be rate-limited collectively. Contact support for IP allowlisting (Enterprise only).</p>

    <hr class="divider">

    <h2>Related Pages</h2>
    <ul>
      <li><a class="link" href="billing-and-quotas.html">Billing &amp; Quotas</a> — Monthly action limits</li>
      <li><a class="link" href="advanced-features.html">Advanced Features</a> — Bulk submission to reduce rate limit impact</li>
      <li><a class="link" href="authentication.html">Authentication</a> — API key setup</li>
      <li><a class="link" href="api-reference.html">API Reference</a> — Complete endpoint documentation</li>
    </ul>
  </main>

  <footer>
    <a href="https://gaas.is">&copy; H2Om</a>
  </footer>
<script src="search.js"></script>
<script src="constellation.js"></script>
</body>
</html>
